<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Prático Mosten</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/app.js"></script>
</head>
<body>
    <main class="conteudo flex column">
        <div class="headerPagina flex">
            <p class="tituloPagina">Lista geral de votos</p>
            <button class="btnHeader" onclick="window.location.href='../pages/index.html'">Página inicial</button>
        </div>

        <p class="subtituloPaginaLista">Votos Totais</p>
        <div class="areaVotosGerais flex">
            <div class="votosGeraisGostei" id="votosGosteiTotal">Gostei: 0</div>
            <div class="votosGeraisNaoGostei" id="votosNaoGosteiTotal">Não gostei: 0</div>
        </div>

        <p class="subtituloPaginaLista">Votos Unitários</p>

        <div class="areaVotoUnitario flex" id="areaVotoUnitario">
            <!-- Os filmes serão listados aqui dinamicamente -->
        </div>
    </main>

    <script>
        // Função para carregar filmes da API
        window.onload = function() {
            fetch('/api/filmes')
                .then(response => response.json())
                .then(filmes => {
                    mostrarFilmes(filmes);
                    atualizarVotosTotais(filmes); // Atualizar os votos totais
                })
                .catch(error => {
                    console.error('Erro ao carregar filmes:', error);
                });
        };

        // Função para exibir os filmes na página e os votos de cada um
        function mostrarFilmes(filmes) {
            const areaVotoUnitario = document.getElementById('areaVotoUnitario');
            areaVotoUnitario.innerHTML = ''; // Limpa a área antes de adicionar novos filmes

            filmes.forEach(filme => {
                const itemVotoUnitario = document.createElement('div');
                itemVotoUnitario.classList.add('itemVotoUnitario', 'flex', 'column');

                itemVotoUnitario.innerHTML = `
                    <p class="tituloItemVotoUnitario">${filme.titulo}</p>
                    <div class="areaVotosItemUnitario flex">
                        <div class="votosGosteiUnitario">Gostei: ${filme.gostei}</div>
                        <div class="votosNaoGosteiUnitario">Não Gostei: ${filme.naogostei}</div>
                    </div>
                `;

                areaVotoUnitario.appendChild(itemVotoUnitario);
            });
        }

        // Função para atualizar os votos totais (soma dos votos de todos os filmes)
        function atualizarVotosTotais(filmes) {
            const votosGosteiTotal = filmes.reduce((total, filme) => total + filme.gostei, 0);
            const votosNaoGosteiTotal = filmes.reduce((total, filme) => total + filme.naogostei, 0);

            // Atualiza os votos totais no HTML
            document.getElementById('votosGosteiTotal').textContent = `Gostei: ${votosGosteiTotal}`;
            document.getElementById('votosNaoGosteiTotal').textContent = `Não gostei: ${votosNaoGosteiTotal}`;
        }
    </script>
</body>
</html>
